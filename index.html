function doPost(e) {
  const data = JSON.parse(e.postData.contents);
  // The sheet must have 12 columns: Test ID | Date | Test Type | Section | Marks | Total | Notes | Provider | Maths | English | Reasoning | GK
  const sheet = SpreadsheetApp.getActiveSpreadsheet().getSheetByName(data.username);
  
  // Use provided testDate if available; otherwise use current date.
  const testDate = data.testDate ? new Date(data.testDate) : new Date();
  
  // Determine total marks based on test type.
  let total;
  if (data.testType === 'full') {
    total = 200; // Full test overall mark.
  } else {
    total = 50;
  }
  
  // Append row with 12 columns:
  // Test ID | Date | Test Type | Section | Marks | Total | Notes | Provider | Maths | English | Reasoning | GK
  sheet.appendRow([
    data.testID,
    testDate,
    data.testType,
    data.section,
    data.marks,
    total,
    data.notes || '',
    data.provider,
    data.Math,
    data.English,
    data.Reasoning,
    data.GK
  ]);
  
  return ContentService.createTextOutput("Success");
}
